
<!--

//
//   Copyright (C) 2014 Menlo Park Innovation LLC
//
//   menloparkinnovation.com
//   menloparkinnovation@gmail.com
//
//   Licensed under the Apache License, Version 2.0 (the "License");
//   you may not use this file except in compliance with the License.
//   You may obtain a copy of the License at
//
//       http://www.apache.org/licenses/LICENSE-2.0
//
//   Unless required by applicable law or agreed to in writing, software
//   distributed under the License is distributed on an "AS IS" BASIS,
//   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
//   See the License for the specific language governing permissions and
//   limitations under the License.
//

//
//   Openpuxclient.js
//
//   Openpux Internet Of Things (IOT) Framework.
//
//   Copyright (C) 2014 Menlo Park Innovation LLC
//
//   menloparkinnovation.com
//   menloparkinnovation@gmail.com
//
//   Snapshot License
//
//   This license is for a specific snapshot of a base work of
//   Menlo Park Innovation LLC on a non-exclusive basis with no warranty
//   or obligation for future updates. This work, any portion, or derivative
//   of it may be made available under other license terms by
//   Menlo Park Innovation LLC without notice or obligation to this license.
//
//   There is no warranty, statement of fitness, statement of
//   fitness for any purpose, and no statements as to infringements
//   on any patents.
//
//   Menlo Park Innovation has no obligation to offer support, updates,
//   future revisions and improvements, source code, source code downloads,
//   media, etc.
//
//   This specific snapshot is made available under the terms of
//   the Apache License Version 2.0 of January 2004
//   http://www.apache.org/licenses/
//

-->

<!-- Openpux AJAX/REST Sensor Data Query/Update Application -->

<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
http://www.w3.org/TR/html4/strict.dtd">

  <head>
    <title>Openpux Sensor Data Query/Update Application</title>
  </head>
  <body bgcolor=white>
  </body>

<script type="text/javascript">
// Sensor Query/Update page navigation handler

window.onload = function() {
    showPage();
}

//
// <!-- Copyright (C) 2013, 2014 Menlo Park Innovation LLC -->
//
// Structure of Application:
//
// This is an AJAX (Asynchronous Javascript) rich HTML application over REST
// (Representational State Transfer) using JSON (JavaScript Object Notation)
// using HTTP/HTTP transport.
//
// It's designed to run client side in modern browsers on phones, tablets, laptops,
// and traditional desktop PC's regardless of operating system/browser by using
// HTML standards 5.x and above.
//
// The main page contains a navigation form inside an HTML table used
// for formatting. This form provides the "controller" of the MVC
// "Model View Controller" model of which page(s) and forms are visible
// to the user based on actions and events.
//
// This navigation page controls a set of HTML form based REST/JSON applications
// using a standard pattern of createForm()/showForm()/disableForm().
//

//
// These values set what is displayed for the user.
//
SensorReading0 = "Current Temperature"
SensorReading1 = "Current Humidity"
SensorReading2 = "Auto Mode";
SensorReading3 = "Relay State";
SensorReading4 = "Interior Light State";
SensorReading5 = null;
SensorReading6 = null;
SensorReading7 = null;
SensorReading8 = null;
SensorReading9 = null;

TargetMask0 = "Target Temperature";
TargetMask1 = "Target Humidity";
TargetMask2 = "Temperature Hysteresis";
TargetMask3 = "Humidity Hysteresis";
TargetMask4 = "Interior Light On";

function showPage() {

    document.write("<table>");

    document.write("<tr>");

    <!-- Create a form for navigation buttons -->

    formStart(
        "navigationform",
        "navigationformaction",
        "get",
        "return validatenavigationform()",
        "application/www.form-urlencoded"
    );

    document.write("<td>");
    formCreateInput("button", "buttonquery", "Query Sensor", "navigateQuery();");
    document.write("</td>");

    document.write("<td>");
    formCreateInput("button", "buttonupdate", "Update Sensor", "navigateUpdate();");
    document.write("</td>");

    document.write("<td>");
    formCreateInput("button", "buttonaddreading", "Add Reading", "navigateAddReading();");
    document.write("</td>");

    document.write("<td>");
    formCreateInput("button", "buttonreload", "Reload", "location.reload();");
    document.write("</td>");

    formStop();

    document.write("</tr>");

    document.write("</table>");

    showSensorAccountForm();
}

function navigateQuery() {

    // Disable previous form(s)
    disableSensorUpdateForm();
    disableAddReadingForm();

    // Disable the response until we have one
    disableSensorQueryResponseForm();

    showSensorQueryForm();
}

function navigateUpdate() {

    // Disable previous form(s)
    disableSensorQueryResponseForm();
    disableSensorQueryForm();
    disableAddReadingForm();

    // Show sensor update form
    showSensorUpdateForm();
}

function navigateAddReading() {

    // Disable previous form(s)
    disableSensorQueryResponseForm();
    disableSensorQueryForm();
    disableAddReadingForm();

    // Show sensor update form
    showAddReadingForm();
}

// Sensor Query/Update page navigation handler
</script>

<script type="text/javascript" src="openpuxclient.js">
// Load the openpux rest library
</script>

<script type="text/javascript">
// Openpux Sensor Update Application

function showSensorAccountForm() {

    createSensorAccountForm();

    if (document.forms["sensoraccountform"] != null) {
        document.forms["sensoraccountform"].hidden = false;
    }
}

function disableSensorAccountForm() {
    if (document.forms["sensoraccountform"] != null) {
        document.forms["sensoraccountform"].hidden = true;
    }
}

function createSensorAccountForm() {

    if (document.forms["sensoraccountform"] != null) {
        // already created
        return;
    }

    formStart(
        "sensoraccountform",
        "sensoraccountformaction",
        "get",
        "return validatesensoraccountform()",
        "application/www.form-urlencoded"
    );

    formCreateInputWithTitle("AccountID", "text", "accountid", "1");
    formCreateInputWithTitle("PassCode", "text", "passcode", "12345678");
    formCreateInputWithTitle("SensorID", "text", "sensorid", "1");

    formStop();
}

function showSensorUpdateForm() {

    createSensorUpdateForm();

    if (document.forms["updatesensorform"] != null) {
        document.forms["updatesensorform"].hidden = false;
    }
}

function disableSensorUpdateForm() {
    if (document.forms["updatesensorform"] != null) {
        document.forms["updatesensorform"].hidden = true;
    }
}

function createSensorUpdateForm() {

    if (document.forms["updatesensorform"] != null) {
        // already created
        return;
    }

    formStart(
        "updatesensorform",
        "updatesensorformaction",
        "post",
        "return validateupdatesensorform()",
        "application/www.form-urlencoded"
    );

    formCreateInputWithTitle("SleepTime", "text", "sleeptime", null);

    if (TargetMask0 != null) {
        formCreateInputWithTitle(TargetMask0, "text", "targetmask0", null);
    }

    if (TargetMask1 != null) {
        formCreateInputWithTitle(TargetMask1, "text", "targetmask1", null);
    }

    if (TargetMask2 != null) {
        formCreateInputWithTitle(TargetMask2, "text", "targetmask2", null);
    }

    if (TargetMask3 != null) {
        formCreateInputWithTitle(TargetMask3, "text", "targetmask3", null);
    }

    if (TargetMask4 != null) {
        formCreateInputWithTitle(TargetMask3, "text", "targetmask4", null);
    }

    document.write("<a href=\"javascript: processSensorUpdateForm()\">Update Sensor</a><br>");
    formCreateInputWithTitle("Status", "text", "status");

    formStop();
}

//
// Process the sensor update form
//
function processSensorUpdateForm()
{
  // Scheme is unsecured http vs. https
  var scheme = "http";

  // Get host from the browsers environment
  var host = location.host;

  // no http auth information
  var httpauthusername = null;
  var httpauthpassword = null;

  //
  // Get input values from the DOM
  //

  // sensoraccountform
  var accountid = document.forms["sensoraccountform"]["accountid"].value;
  var passcode = document.forms["sensoraccountform"]["passcode"].value;
  var sensorid = document.forms["sensoraccountform"]["sensorid"].value;

  var sleeptime = document.forms["updatesensorform"]["sleeptime"].value;

  if (document.forms["updatesensorform"]["targetmask0"] != null) {
      var targetmask0 = document.forms["updatesensorform"]["targetmask0"].value;
  }

  if (document.forms["updatesensorform"]["targetmask1"] != null) {
      var targetmask1 = document.forms["updatesensorform"]["targetmask1"].value;
  }

  if (document.forms["updatesensorform"]["targetmask2"] != null) {
      var targetmask2 = document.forms["updatesensorform"]["targetmask2"].value;
  }

  if (document.forms["updatesensorform"]["targetmask3"] != null) {
      var targetmask3 = document.forms["updatesensorform"]["targetmask3"].value;
  }

  if (document.forms["updatesensorform"]["targetmask4"] != null) {
      var targetmask4 = document.forms["updatesensorform"]["targetmask4"].value;
  }

  if (accountid==null || accountid=="") {
    alert("Must supply AccountID");
    return;
  }

  if (passcode==null || passcode=="") {
    alert("Must supply PassCode");
    return;
  }

  if (sensorid==null || sensorid=="") {
    alert("Must supply SensorID");
    return;
  }

  // Must supply at least one update
  var update = false;

  if (sleeptime != null && sleeptime != "") update = true;
  if (targetmask0 != null && targetmask0 != "") update = true;
  if (targetmask1 != null && targetmask1 != "") update = true;
  if (targetmask2 != null && targetmask2 != "") update = true;
  if (targetmask3 != null && targetmask3 != "") update = true;
  if (targetmask4 != null && targetmask4 != "") update = true;

  if (!update) {
      alert("At least one sensor update value must be entered");
      return;
  }

  var result = updateSensorTargetState(
      scheme,
      host,
      httpauthusername,
      httpauthpassword,
      processSensorUpdateFormResponse,
      accountid,
      passcode,
      sensorid,
      sleeptime,
      targetmask0,
      targetmask1,
      targetmask2,
      targetmask3
      );

  if (result != null) {
    alert("Local Error Status: " + result);
  }

  return ;
}

function processSensorUpdateFormResponse(responseDocument) {
      if (responseDocument == null) {
          responseDocument = "null";
      }

      var obj = JSON.parse(responseDocument);

      var status = obj.status;
      if (status != "200 OK") {
          document.forms["updatesensorform"]["status"].value = status;
          return;
      }

      document.forms["updatesensorform"]["status"].value = status;
}

// Openpux Sensor Update Application
</script>

<script type="text/javascript">
// Openpux Sensor Query Application

function showSensorQueryForm() {

    createSensorQueryForm();

    if (document.forms["querysensorform"] != null) {
        document.forms["querysensorform"].hidden = false;
    }
}

function disableSensorQueryForm() {
    if (document.forms["querysensorform"] != null) {
        document.forms["querysensorform"].hidden = true;
    }
}

function createSensorQueryForm() {

    if (document.forms["querysensorform"] != null) {
        // already created
        return;
    }

    //
    // These forms don't really post, but provide the
    // input controls read by the Javascript implementing
    // the client application.
    //
    formStart(
        "querysensorform",
        "querysensorformaction",
        "post",
        "return validatequerysensorform()",
        "application/www.form-urlencoded"
    );

    formCreateInputWithTitle("Reading Count", "text", "readingcount", "1");
    formCreateInputWithTitle("StartDate", "text", "startdate");
    formCreateInputWithTitle("EndDate", "text", "enddate");

    //formCreateInputWithTitle("StartDate", "text", "startdate", "2013:01:01:00:00:00");
    //formCreateInputWithTitle("EndDate", "text", "enddate", "2022:01:01:00:00:00");

    document.write("<a href=\"javascript: processSensorQueryForm()\">Submit Query</a><br>");

    formStop();
}

function processSensorQueryForm() {

    // Scheme is unsecured http vs. https
    var scheme = "http";

    // Get host from the browsers environment
    var host = location.host;

    // no http auth information
    var httpauthusername = null;
    var httpauthpassword = null;

    // Get form inputs
    var accountid = document.forms["sensoraccountform"]["accountid"].value;
    var passcode = document.forms["sensoraccountform"]["passcode"].value;
    var sensorid = document.forms["sensoraccountform"]["sensorid"].value;

    var readingcount = document.forms["querysensorform"]["readingcount"].value;
    var startdate = document.forms["querysensorform"]["startdate"].value;
    var enddate = document.forms["querysensorform"]["enddate"].value;

    if (readingcount == null) readingcount = 1;

    result = querySensorReadings(
        scheme,
        host,
        httpauthusername,
        httpauthpassword,
        processSensorQueryFormResponse,
        accountid,
        passcode,
        sensorid,
        readingcount,
        startdate,
        enddate
        );

    if (result != null) {
      alert("Local Error Status: " + result);
    }
}

//
// This is invoked with the response JSON document.
//
// The document may be an error response, or the data requested.
//
function processSensorQueryFormResponse(responseDocument) {
      if (responseDocument == null) {
          responseDocument = "null";
      }

      showSensorQueryResponseForm();

      var obj = JSON.parse(responseDocument);

      var status = obj.status;
      if (status != "200 OK") {
          document.forms["querysensorresponseform"]["status"].value = status;
          //document.write(status + "<br>");
          //document.write(responseDocument + "<br>");
          return;
      }

      for(var index = 0; index < obj.sensorreading.length; index++) {
          processSensorReading(obj.sensorreading[index], status);
      }
}

//
// Disable (make not visible), but not destroy the
// Sensor Query Response Form.
//
// By not destroying it, its current settings remain
// in place.
//
function showSensorQueryResponseForm() {

    createSensorQueryResponseForm();

    if (document.forms["querysensorresponseform"] != null) {
        document.forms["querysensorresponseform"].hidden = false;
    }
}

function disableSensorQueryResponseForm() {

    if (document.forms["querysensorresponseform"] != null) {
        document.forms["querysensorresponseform"].hidden = true;
    }
}

//
// The response form is used to place and update
// the response data from the sensor query..
//
function createSensorQueryResponseForm() {

    if (document.forms["querysensorresponseform"] != null) {
        // already created
        return;
    }

    //
    // These forms don't really post, but provide the
    // input controls read by the Javascript implementing
    // the client application.
    //
    formStart(
        "querysensorresponseform",
        "querysensorresponseformaction",
        "post",
        "return validatequerysensorresponseform()",
        "application/www.form-urlencoded"
    );

    formCreateInputWithTitle("Status", "text", "status");
    formCreateInputWithTitle("TimeAdded", "text", "timeadded");

    if (TargetMask0 != null) {
        formCreateInputWithTitle(TargetMask0, "text", "targetmask0");
    }

    if (TargetMask1 != null) {
        formCreateInputWithTitle(TargetMask1, "text", "targetmask1");
    }

    if (TargetMask2 != null) {
        formCreateInputWithTitle(TargetMask2, "text", "targetmask2");
    }

    if (TargetMask3 != null) {
        formCreateInputWithTitle(TargetMask3, "text", "targetmask3");
    }

    if (TargetMask4 != null) {
        formCreateInputWithTitle(TargetMask4, "text", "targetmask4");
    }

    if (SensorReading0 != null) {
       formCreateInputWithTitle(SensorReading0, "text", "sensorreading0");
    }

    if (SensorReading1 != null) {
        formCreateInputWithTitle(SensorReading1, "text", "sensorreading1");
    }

    if (SensorReading2 != null) {
        formCreateInputWithTitle(SensorReading2, "text", "sensorreading2");
    }

    if (SensorReading3 != null) {
       formCreateInputWithTitle("SensorReading3", "text", "sensorreading3");
    }

    if (SensorReading4 != null) {
       formCreateInputWithTitle("SensorReading4", "text", "sensorreading4");
    }

    if (SensorReading5 != null) {
        formCreateInputWithTitle("SensorReading5", "text", "sensorreading5");
    }

    if (SensorReading6 != null) {
        formCreateInputWithTitle("SensorReading6", "text", "sensorreading6");
    }

    if (SensorReading7 != null) {
        formCreateInputWithTitle("SensorReading7", "text", "sensorreading7");
    }

    if (SensorReading8 != null) {
        formCreateInputWithTitle("SensorReading8", "text", "sensorreading8");
    }

    if (SensorReading9 != null) {
        formCreateInputWithTitle("SensorReading9", "text", "sensorreading9");
    }

    formStop();
}

function updateSensorQueryResponseForm(
    status,
    timeadded,
    targetmask0,
    targetmask1,
    targetmask2,
    targetmask3,
    sensorreading0,
    sensorreading1,
    sensorreading2,
    sensorreading3,
    sensorreading4,
    sensorreading5,
    sensorreading6,
    sensorreading7,
    sensorreading8,
    sensorreading9
    )
{
    if (status != null) {
        document.forms["querysensorresponseform"]["status"].value = status;
    }

    if (timeadded != null) {
        var date = new Date(timeadded);
        document.forms["querysensorresponseform"]["timeadded"].value = date.toISOString();
    }

    if ((TargetMask0 != null) && (targetmask0 != null)) {
        document.forms["querysensorresponseform"]["targetmask0"].value = targetmask0;
    }

    if ((TargetMask1 != null) && (targetmask1 != null)) {
        document.forms["querysensorresponseform"]["targetmask1"].value = targetmask1;
    }

    if ((TargetMask2 != null) && (targetmask2 != null)) {
        document.forms["querysensorresponseform"]["targetmask2"].value = targetmask2;
    }

    if ((TargetMask3 != null) && (targetmask3 != null)) {
        document.forms["querysensorresponseform"]["targetmask3"].value = targetmask3;
    }

    if ((SensorReading0 != null) && (sensorreading0 != null)) {
        document.forms["querysensorresponseform"]["sensorreading0"].value = sensorreading0;
    }

    if ((SensorReading1 != null) && (sensorreading1 != null)) {
        document.forms["querysensorresponseform"]["sensorreading1"].value = sensorreading1;
    }

    if ((SensorReading2 != null) && (sensorreading2 != null)) {
        document.forms["querysensorresponseform"]["sensorreading2"].value = sensorreading2;
    }

    if ((SensorReading3 != null) && (sensorreading3 != null)) {
        document.forms["querysensorresponseform"]["sensorreading3"].value = sensorreading3;
    }

    if ((SensorReading4 != null) && (sensorreading4 != null)) {
        document.forms["querysensorresponseform"]["sensorreading4"].value = sensorreading4;
    }

    if ((SensorReading5 != null) && (sensorreading5 != null)) {
        document.forms["querysensorresponseform"]["sensorreading5"].value = sensorreading5;
    }

    if ((SensorReading6 != null) && (sensorreading6 != null)) {
        document.forms["querysensorresponseform"]["sensorreading6"].value = sensorreading6;
    }

    if ((SensorReading7 != null) && (sensorreading7 != null)) {
        document.forms["querysensorresponseform"]["sensorreading7"].value = sensorreading7;
    }

    if ((SensorReading8 != null) && (sensorreading8 != null)) {
        document.forms["querysensorresponseform"]["sensorreading8"].value = sensorreading8;
    }

    if ((SensorReading9 != null) && (sensorreading9 != null)) {
        document.forms["querysensorresponseform"]["sensorreading9"].value = sensorreading9;
    }
}

//
// This is used to add a reading
//
function createAddReadingForm() {

    if (document.forms["addreadingform"] != null) {
        // already created
        return;
    }

    //
    // These forms don't really post, but provide the
    // input controls read by the Javascript implementing
    // the client application.
    //
    formStart(
        "addreadingform",
        "addreadingformaction",
        "post",
        "return validateaddreadingresponseform()",
        "application/www.form-urlencoded"
    );

    document.write("<a href=\"javascript: processAddReadingForm()\">Add Reading</a><br>");

    formCreateInputWithTitle("Status", "text", "status");
    formCreateInputWithTitle("ResponseString", "text", "responsestring");

    if (TargetMask0 != null) {
        formCreateInputWithTitle(TargetMask0, "text", "targetmask0");
    }

    if (TargetMask1 != null) {
        formCreateInputWithTitle(TargetMask1, "text", "targetmask1");
    }

    if (TargetMask2 != null) {
        formCreateInputWithTitle(TargetMask2, "text", "targetmask2");
    }

    if (TargetMask3 != null) {
        formCreateInputWithTitle(TargetMask3, "text", "targetmask3");
    }

    if (SensorReading0 != null) {
        formCreateInputWithTitle(SensorReading0, "text", "sensorreading0");
    }

    if (SensorReading1 != null) {
        formCreateInputWithTitle(SensorReading1, "text", "sensorreading1");
    }

    if (SensorReading2 != null) {
        formCreateInputWithTitle(SensorReading2, "text", "sensorreading2");
    }

    if (SensorReading3 != null) {
        formCreateInputWithTitle(SensorReading3, "text", "sensorreading3");
    }

    if (SensorReading4 != null) {
        formCreateInputWithTitle(SensorReading4, "text", "sensorreading4");
    }

    if (SensorReading5 != null) {
        formCreateInputWithTitle(SensorReading5, "text", "sensorreading5");
    }

    if (SensorReading6 != null) {
        formCreateInputWithTitle(SensorReading6, "text", "sensorreading6");
    }

    if (SensorReading7 != null) {
        formCreateInputWithTitle(SensorReading7, "text", "sensorreading7");
    }

    if (SensorReading8 != null) {
        formCreateInputWithTitle(SensorReading8, "text", "sensorreading8");
    }

    if (SensorReading9 != null) {
        formCreateInputWithTitle(SensorReading9, "text", "sensorreading9");
    }

    formStop();
}

//
// Process the sensor update form
//
function processAddReadingForm()
{
  // Scheme is unsecured http vs. https
  var scheme = "http";

  // Get host from the browsers environment
  var host = location.host;

  // no http auth information
  var httpauthusername = null;
  var httpauthpassword = null;

  //
  // Get input values from the DOM
  //

  var o = new Object();

  // sensoraccountform
  o.AccountID = document.forms["sensoraccountform"]["accountid"].value;
  o.PassCode = document.forms["sensoraccountform"]["passcode"].value;
  o.SensorID = document.forms["sensoraccountform"]["sensorid"].value;

  if (document.forms["addreadingform"]["targetmask0"] != null) {
      o.TargetMask0 = document.forms["addreadingform"]["targetmask0"].value;
  }

  if (document.forms["addreadingform"]["targetmask1"] != null) {
      o.TargetMask1 = document.forms["addreadingform"]["targetmask1"].value;
  }

  if (document.forms["addreadingform"]["targetmask2"] != null) {
      o.TargetMask2 = document.forms["addreadingform"]["targetmask2"].value;
  }

  if (document.forms["addreadingform"]["targetmask3"] != null) {
      o.TargetMask3 = document.forms["addreadingform"]["targetmask3"].value;
  }

  if (document.forms["addreadingform"]["sensorreading0"] != null) {
      o.SensorReading0 = document.forms["addreadingform"]["sensorreading0"].value;
  }

  if (document.forms["addreadingform"]["sensorreading1"] != null) {
      o.SensorReading1 = document.forms["addreadingform"]["sensorreading1"].value;
  }

  if (document.forms["addreadingform"]["sensorreading2"] != null) {
      o.SensorReading2 = document.forms["addreadingform"]["sensorreading2"].value;
  }

  if (document.forms["addreadingform"]["sensorreading3"] != null) {
      o.SensorReading3 = document.forms["addreadingform"]["sensorreading3"].value;
  }

  if (document.forms["addreadingform"]["sensorreading4"] != null) {
      o.SensorReading4 = document.forms["addreadingform"]["sensorreading4"].value;
  }

  if (document.forms["addreadingform"]["sensorreading5"] != null) {
      o.SensorReading5 = document.forms["addreadingform"]["sensorreading5"].value;
  }

  if (document.forms["addreadingform"]["sensorreading6"] != null) {
      o.SensorReading6 = document.forms["addreadingform"]["sensorreading6"].value;
  }

  if (document.forms["addreadingform"]["sensorreading7"] != null) {
      o.SensorReading7 = document.forms["addreadingform"]["sensorreading7"].value;
  }

  if (document.forms["addreadingform"]["sensorreading8"] != null) {
      o.SensorReading8 = document.forms["addreadingform"]["sensorreading8"].value;
  }

  if (document.forms["addreadingform"]["sensorreading9"] != null) {
      o.SensorReading9 = document.forms["addreadingform"]["sensorreading9"].value;
  }

  if (o.AccountID==null || o.AccountID=="") {
    alert("Must supply AccountID");
    return;
  }

  if (o.PassCode==null || o.PassCode=="") {
    alert("Must supply PassCode");
    return;
  }

  if (o.SensorID==null || o.SensorID=="") {
    alert("Must supply SensorID");
    return;
  }

  // Must supply at least one update
  var update = false;

  if (o.TargetMask0 != null && o.TargetMask0 != "") update = true;

  if (o.SensorReading0 != null && o.SensorReading0 != "") update = true;

  if (!update) {
      alert("At least one sensor update value must be entered");
      return;
  }

  var result = addSensorReadingShortForm(
      scheme,
      host,
      httpauthusername,
      httpauthpassword,
      processAddSensorReadingFormResponse,
      o
      );

  if (result != null) {
    alert("Local Error Status: " + result);
  }

  return ;
}

function processAddSensorReadingFormResponse(responseDocument)
{
      if (responseDocument == null) {
          responseDocument = "null";

          document.forms["addreadingform"]["status"].value = "response document == null";
          return;
      }

      var Status = "200 OK";

      // See if its a JSON based error status return
      if (responseDocument[0] == '{') {
          var obj = JSON.parse(responseDocument);
          status = obj.status;
      }

      if (status != "200 OK") {
          document.forms["addreadingform"]["status"].value = status;
          return;
      }

      document.forms["addreadingform"]["status"].value = status;

      document.forms["addreadingform"]["responsestring"].value = responseDocument;

      // C=10&S=30&M0=0&M1=ff&M2=0&M3=0
      var shortFormItems = processQueryString(responseDocument);

      var items = convertFromShortForm(shortFormItems);

      // TODO: Fill in detailed responses

}

function showAddReadingForm() {

    createAddReadingForm();

    if (document.forms["addreadingform"] != null) {
        document.forms["addreadingform"].hidden = false;
    }
}

function disableAddReadingForm() {
    if (document.forms["addreadingform"] != null) {
        document.forms["addreadingform"].hidden = true;
    }
}

function processSensorReading(sensorreading, status) {

    // Extract the readings from the parsed JSON response document entry
    var sensorid = sensorreading.SensorID;
    var timeadded= sensorreading.TimeAdded;

    var targetmask0 = sensorreading.TargetMask0;
    var targetmask1 = sensorreading.TargetMask1;
    var targetmask2 = sensorreading.TargetMask2;
    var targetmask3 = sensorreading.TargetMask3;

    var sensorreading0 = sensorreading.SensorReading0;
    var sensorreading1 = sensorreading.SensorReading1;
    var sensorreading2 = sensorreading.SensorReading2;
    var sensorreading3 = sensorreading.SensorReading3;
    var sensorreading4 = sensorreading.SensorReading4;
    var sensorreading5 = sensorreading.SensorReading5;
    var sensorreading6 = sensorreading.SensorReading6;
    var sensorreading7 = sensorreading.SensorReading7;
    var sensorreading8 = sensorreading.SensorReading8;
    var sensorreading9 = sensorreading.SensorReading9;

    updateSensorQueryResponseForm(
        status,
        timeadded,
        targetmask0,
        targetmask1,
        targetmask2,
        targetmask3,
        sensorreading0,
        sensorreading1,
        sensorreading2,
        sensorreading3,
        sensorreading4,
        sensorreading5,
        sensorreading6,
        sensorreading7,
        sensorreading8,
        sensorreading9
        );
}

function printSensorReading(
    sensorid,
    timeadded,
    targetmask0,
    targetmask1,
    targetmask2,
    targetmask3,
    sensorreading0,
    sensorreading1,
    sensorreading2,
    sensorreading3,
    sensorreading4,
    sensorreading5,
    sensorreading6,
    sensorreading7,
    sensorreading8,
    sensorreading9
    )
{
    document.write("SensorID=" + sensorid + "<br>");

    if (timeadded != null) {
        document.write("TimeAdded=" + timeadded + "<br>");
    }

    if (sensorreading0 != null) {
        document.write("SensorReading0=" + sensorreading0 + "<br>");
    }

    if (sensorreading1 != null) {
        document.write("SensorReading1=" + sensorreading1 + "<br>");
    }

    if (sensorreading2 != null) {
        document.write("SensorReading2=" + sensorreading2 + "<br>");
    }

    if (sensorreading3 != null) {
        document.write("SensorReading3=" + sensorreading3 + "<br>");
    }

    if (sensorreading4 != null) {
        document.write("SensorReading4=" + sensorreading4 + "<br>");
    }

    if (sensorreading5 != null) {
        document.write("SensorReading5=" + sensorreading5 + "<br>");
    }

    if (sensorreading6 != null) {
        document.write("SensorReading6=" + sensorreading6 + "<br>");
    }

    if (sensorreading7 != null) {
        document.write("SensorReading7=" + sensorreading7 + "<br>");
    }

    if (sensorreading8 != null) {
        document.write("SensorReading8=" + sensorreading8 + "<br>");
    }

    if (sensorreading9 != null) {
        document.write("SensorReading9=" + sensorreading9 + "<br>");
    }

    if (targetmask0 != null) {
        document.write("TargetMask0=" + targetmask0 + "<br>");
    }

    if (targetmask1 != null) {
        document.write("TargetMask1=" + targetmask1 + "<br>");
    }

    if (targetmask2 != null) {
        document.write("TargetMask2=" + targetmask2 + "<br>");
    }

    if (targetmask3 != null) {
        document.write("TargetMask3=" + targetmask3 + "<br>");
    }
}

// Openpux Sensor Query Application
</script>

<script type="text/javascript">
// Form Library

//
// Start a Form
//
function formStart(
    formname,
    formaction,
    formmethod,
    formonsubmit,
    formenctype
    )
{
    document.write("<form name=\"" + formname + "\" action=\"" + formaction + "\" method=\"" + formmethod + "\"" );
    document.write("onsubmit=\"" + formonsubmit + "\"");
    document.write("enctype=\"" + formenctype + "\">");
}

function formStop() {
    document.write("</form>");
}

function formCreateInput(inputType, inputName, inputValue, onclick) {

    document.write("<input type=\"" + inputType + "\"" + " name=\"" + inputName + "\"");

    if (onclick != null) {
        document.write(" onclick=\"" + onclick + "\"");
    }

    if (inputValue != null) {
        document.write(" value=\"" + inputValue + "\"");
    }

    document.write("/>");
}

function formCreateInputWithTitle(title, inputType, inputName, inputValue) {

    document.write(title);
    formCreateInput(inputType, inputName, inputValue);
    document.write("<br>");
}

// Form Library
</script>

</html>

